---
import '@/styles/global.css';

interface Props {
  title: string;
  description?: string;
}

const { title, description = 'A personal AI brainstorming workspace — every conversation, plan, and breakthrough traced over time.' } = Astro.props;
const canonicalURL = new URL(Astro.url.pathname, Astro.site ?? 'https://ai-chat-generator.local');
const pathname = Astro.url.pathname;
const isHome = pathname === '/';
const isDocs = pathname.startsWith('/docs');
---

<!doctype html>
<html lang="en" class="scroll-smooth">
  <head>
    <!-- Anti-FOUC: read saved theme before first paint (synchronous, blocks render) -->
    <script is:inline>
      (function () {
        var saved = localStorage.getItem('theme');
        // Default to dark; only go light if explicitly saved
        if (saved === 'light') {
          document.documentElement.classList.remove('dark');
        } else {
          document.documentElement.classList.add('dark');
        }
      })();
    </script>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content={description} />
    <link rel="canonical" href={canonicalURL} />
    <meta property="og:title"       content={`${title} | AI Chat Generator`} />
    <meta property="og:description" content={description} />
    <meta property="og:type"        content="website" />
    <meta property="og:url"         content={canonicalURL} />
    <meta name="twitter:card"        content="summary" />
    <meta name="twitter:title"       content={`${title} | AI Chat Generator`} />
    <meta name="twitter:description" content={description} />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <title>{title} | AI Chat Generator</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
  </head>
  <body class="min-h-screen font-sans">
    <!-- Header -->
    <header class="site-header">
      <div class="header-inner">
        <!-- Logo -->
        <a href="/" class="site-logo group">
          <div class="logo-icon">
            <svg class="w-4 h-4 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" />
            </svg>
          </div>
          <span class="logo-text">AI Chat Generator</span>
        </a>

        <!-- Nav links -->
        <nav class="header-nav">
          <a href="/" class={`nav-item ${isHome ? 'nav-item--active' : ''}`}>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            Timeline
          </a>
          <a href="/docs" class={`nav-item ${isDocs ? 'nav-item--active' : ''}`}>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25"/>
            </svg>
            Docs
          </a>

          <div class="nav-sep" aria-hidden="true"></div>

          <!-- Dark / Light toggle -->
          <button id="theme-toggle" aria-label="Toggle dark/light mode" class="nav-toggle">
            <svg id="icon-sun" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="5"/>
              <path stroke-linecap="round" d="M12 2v2M12 20v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M2 12h2M20 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
            </svg>
            <svg id="icon-moon" class="w-4 h-4 hidden" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/>
            </svg>
          </button>
        </nav>
      </div>
      <!-- Gradient accent line -->
      <div class="header-line" aria-hidden="true"></div>
    </header>

    <!-- Depth veil: sits between fixed canvas (z:-1) and page content (z:1).
         Creates a subtle radial fog so text/cards always read cleanly above the 3D. -->
    <div class="depth-veil" aria-hidden="true"></div>

    <!-- Full-width hero slot (outside max-w constraint) -->
    <slot name="hero" />

    <!-- Constrained main content -->
    <main class="max-w-6xl mx-auto px-4">
      <slot />
    </main>

    <!-- Footer -->
    <footer class="border-t border-border/60 mt-20">
      <div class="max-w-6xl mx-auto px-4 py-8 text-center text-xs text-muted-foreground">
        Built with Astro, React & Tailwind CSS
      </div>
    </footer>

    <!-- Theme toggle logic — runs as module after DOM is ready -->
    <script>
      const sun = document.getElementById('icon-sun') as HTMLElement | null;
      const moon = document.getElementById('icon-moon') as HTMLElement | null;
      const btn = document.getElementById('theme-toggle');

      function syncIcons() {
        const dark = document.documentElement.classList.contains('dark');
        sun?.classList.toggle('hidden', !dark);
        moon?.classList.toggle('hidden', dark);
      }

      syncIcons();

      btn?.addEventListener('click', () => {
        const isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('theme', isDark ? 'dark' : 'light');
        syncIcons();
      });
    </script>

    <style is:global>
    /* ===== MODERN NAVBAR ============================= */
    .site-header {
      position: sticky;
      top: 0;
      z-index: 50;
      backdrop-filter: blur(28px);
      -webkit-backdrop-filter: blur(18px);
      background: hsl(var(--background) / 0.82);
    }
    .header-inner {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 1.25rem;
      height: 3.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }
    /* Logo */
    .site-logo {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      text-decoration: none;
      flex-shrink: 0;
    }
    .logo-icon {
      width: 30px; height: 30px;
      border-radius: 8px;
      background: linear-gradient(135deg, #3b82f6, #7c3aed);
      display: flex; align-items: center; justify-content: center;
      box-shadow: 0 0 0 0 rgba(99,102,241,0.4);
      transition: box-shadow 0.25s;
    }
    .site-logo:hover .logo-icon {
      box-shadow: 0 0 0 4px rgba(99,102,241,0.18), 0 0 16px rgba(99,102,241,0.25);
    }
    .logo-text {
      font-size: 14px;
      font-weight: 600;
      letter-spacing: -0.01em;
      color: hsl(var(--foreground) / 0.9);
      transition: color 0.15s;
    }
    .site-logo:hover .logo-text { color: hsl(var(--foreground)); }

    /* Nav items */
    .header-nav {
      display: flex;
      align-items: center;
      gap: 2px;
    }
    .nav-item {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 0.375rem 0.7rem;
      border-radius: 7px;
      font-size: 13.5px;
      font-weight: 500;
      color: hsl(var(--muted-foreground));
      text-decoration: none;
      transition: color 0.15s, background 0.15s;
      white-space: nowrap;
    }
    .nav-item:hover {
      color: hsl(var(--foreground));
      background: hsl(var(--muted) / 0.65);
    }
    .nav-item--active {
      color: hsl(var(--foreground));
      background: hsl(var(--muted) / 0.5);
    }
    .nav-item--active svg { color: hsl(217 91% 60%); }

    /* Separator */
    .nav-sep {
      width: 1px;
      height: 16px;
      background: hsl(var(--border) / 0.7);
      margin: 0 0.25rem;
    }

    /* Theme toggle */
    .nav-toggle {
      width: 32px; height: 32px;
      border-radius: 7px;
      border: none;
      background: transparent;
      color: hsl(var(--muted-foreground));
      display: flex; align-items: center; justify-content: center;
      cursor: pointer;
      transition: color 0.15s, background 0.15s;
    }
    .nav-toggle:hover {
      color: hsl(var(--foreground));
      background: hsl(var(--muted) / 0.65);
    }

    /* Gradient accent line at bottom of header */
    .header-line {
      height: 1px;
      background: linear-gradient(
        to right,
        transparent 0%,
        rgba(59,130,246,0.3) 30%,
        rgba(139,92,246,0.3) 70%,
        transparent 100%
      );
    }
    </style>
  </body>
</html>
